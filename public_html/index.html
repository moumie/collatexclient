<!DOCTYPE html>
<html>
<head>
    <meta charset="UTF-8"/>
    <title>Client</title>
    <script src="http://ajax.googleapis.com/ajax/libs/jquery/2.1.1/jquery.min.js"></script> 
    <script src="https://cdn.socket.io/socket.io-1.4.5.js"></script> 
    <link rel="stylesheet" type="text/css" href="styles/style.css">
 </head>

<body>
    <p><span id="userrooms">0</span>   rooms</p>
    <p><span id="useronline">0</span> users online</p>
    <p><span id="useronlinelist">0</span> list of users online</p>
    <p><span id="loginid">0</span> is the current user ID</p>
    <p><span id="userid">0</span> is the newly registered user ID</p>
    <p><span id="userdocs">0</span> user saved documents</p><br/>
    <textarea id="latex">Your latex goes here</textarea><br/>
    <form action="demo_form.asp" method="get">
        <br>
        <button id ="save" type="button" value="Save">Save</button>
        <button id="convert" type="button" value="Convert">Convert</button>
        <br><br>
        <button id="register" type="button" value="Register">Register</button>
        <input id="email" type="text" value="Email"/>
        <input id="password" type="text" value="Password"/>
        <br><br>
        <button id="getdocs" type="button" value="User documents">User documents</button>
        <input id="docs" type="text" value="User ID"/>
        <br><br>
        <button id="login" type="button" value="Login">Login</button>
        <input id="loginemail" type="text" value="Email"/>
        <input id="loginpassword" type="text" value="Password"/>
        <br><br>
        <button id="logout" type="button" value="logout">Logout</button>
        <input id="useridinlist" type="text" value="User ID"/>
        <br><br>
        <button id="unsuscribe" type="button" value="Unsuscribe">Unsuscribe</button>
        <!-- <input id="unsuscribe" type="text" value="Room Id"/> -->
        <br><br>
        <button id="getdocconent" type="button" value="Get document Content">Doc path</button>
        <input id="docpath" type="text" value="Document Path"/>
    </form>
    <script>
    $(function () {
     //you can ask socket.io's client to notify the server about disconnect by turning on the sync disconnect on unload flag
        var socket = io.connect('http://localhost:3000',
                         {'sync disconnect on unload':false} ); 
        //get session id         
        var room;
       //Get desired room
        var room=prompt("Please enter your room",'');
        
        socket.on('connect', function() {
        
        socket.emit('subscribe', room);
        console.log('Room = '+room);
        });
        
       //receive server_roomlist from server
        socket.on('server_roomlist',function(content){
            //console.log('From Server:'+ content);
            document.getElementById('userrooms').innerHTML=JSON.stringify(content); 
            //$(latex).append(content);
        });
        
        //receive document content from server
        socket.on('server_getDocContent',function(content){
            console.log('From Server:'+ content);
            document.getElementById('latex').innerHTML=content; 
            //$(latex).append(content);
        });
       
        //receive characters from server
        socket.on('server_character',function(content){
            //console.log('From Server:'+ content);
            document.getElementById('latex').innerHTML=content; 
            //$(latex).append(content);
        });
        //On Keypress
        $('#latex').on('keypress',function(){
            var character= $('#latex').val();
            console.log('To Server:'+ character);
            //send character to servers
            socket.emit('client_character',{buffer:character},room);
            console.log('To Server:'+ {buffer:character} +"---"+room);
           
        });
       
        
        //Saving the textarea content.
        $( "#save" ).click(function() {
            var doc= $('#latex').val();
            //document
            var document = {     
            name: "doc3",
            content: doc,
            owner:'5704c1c4e559001405ae7bd5',
            };
            socket.emit('client_doc' ,document ,room);
        });
         
         //Set returned content in the textarea.
        $( "#getdocconent" ).click(function() {
             var path= $('#docpath').val();
             socket.emit('client_getDocContent' ,path ,room);
        });
         
        //Converting the textarea content.
        $( "#convert" ).click(function() {
             var documentName="doc3.tex";
             socket.emit('client_convert' ,documentName ,room);
        });
         
        //User logout.
        $( "#logout" ).click(function() {
            var logid= $('#useridinlist').val();
             socket.emit('client_logout' ,logid ,room);
        });
        
         //User unsuscribe from a room.
        $( "#unsuscribe" ).click(function() {
            //var logid= $('#useridinlist').val();
             socket.emit('unsubscribe' ,room ,room);
        });
         
          //User login.
        $( "#login" ).click(function() {
            var email= $('#loginemail').val();
            var password= $('#loginpassword').val();
            //alert("e: " + email + " p: "+ password);
            //document
            var user = {     
            userEmail: email,
            userPassword: password
            };
            socket.emit('client_login' ,user ,room);
        });
         
         //Register New User.
        $( "#register" ).click(function() {
            var email= $('#email').val();
            var password= $('#password').val();
            //alert("e: " + email + " p: "+ password);
            //document
            var user = {     
            userEmail: email,
            userPassword: password
            };
            socket.emit('client_register' ,user ,room);
        });
         
        //Get user documents.
        $( "#getdocs" ).click(function() {
             //var userpid="5704c1c4e559001405ae7bd5";
             var userpid = $('#docs').val();
             socket.emit('client_getdocs' ,userpid ,room);
        });
         
        //get list of user docs
        socket.on('server_getdocs',function(docs){
            document.getElementById('userdocs').innerHTML=JSON.stringify(docs);
        });
         
        //get list of users online
        socket.on('server_useronlinelist',function(users){
            document.getElementById('useronlinelist').innerHTML=JSON.stringify(users);
        });
         
        //get newly registered user credentials
        socket.on('server_registration',function(userId){
            document.getElementById('userid').innerHTML=userId;
        });
         
        //get newly registered user credentials
        socket.on('server_login',function(userId){
            document.getElementById('loginid').innerHTML=userId;
        });
         
         //get online users
        socket.on('user_online',function(userOnline){
            document.getElementById('useronline').innerHTML=userOnline;
        });
        
        //get pdf url
        socket.on('server_pdf',function(pdfDocument){
           console.log("Url : "+pdfDocument.url);
        });
    });  
    </script>
   
</body>
</html>